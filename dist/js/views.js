var app=app||{};!function(e){"use strict";app.AppView=Backbone.View.extend({model:app.placesFiltered,el:"#listview-items-container",events:{"click a":"sidebar_click"},initialize:function(){app.placesFiltered=new Backbone.Collection(app.places.toJSON()),e("#search-field").on("input propertychange paste",this.filter_results),e("#search-checkbox").change(this.filter_results),this.render(),_.bindAll(this,"filter_results"),_.bindAll(this,"sidebar_click"),app.placesFiltered.on("reset",this.render,this),app.map=new Map,app.map.initialize("map-canvas"),"ontouchstart"in document.documentElement||e(function(){e("#listview-items").slimScroll({height:"2000px"})})},render:function(){var t=_.template(e("#sidebar-item-template").html());return this.$el.html(t()),t=_.template(e("#num-places-template").html()),e("#num-places").html(t()),this},sidebar_click:function(t){t.preventDefault(),e("a").toggleClass("active",!1);var a=e(t.currentTarget);a.toggleClass("active",!0);var i=a.data("id"),n=app.placesFiltered.models[i];e("#description-image").attr("src",n.get("image")),e("#description-text").html("<p>"+n.get("description")+"...</p>");var r=n.get("name"),l=app.map.search(r,n);l.done(function(e){var t=new Foursquare,a=t.get_reviews(r,e);a.done(function(e,a){t.venue=e,t.tips=a}).fail(function(){}).always(function(a,i){app.map.createMarker(e,r,t)})}).fail(function(){void 0})},filter_results:function(t){var a=e("#search-field").val().toLowerCase(),i=function(t){var i=t.get("name").toLowerCase().indexOf(a)>-1||t.get("address").toLowerCase().indexOf(a)>-1;return e("#search-checkbox").is(":checked")&&(i=i||t.get("description").toLowerCase().indexOf(a)>-1),i};app.placesFiltered.reset(filteredCollection(app.places,i))}})}(jQuery);