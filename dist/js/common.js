var Map=function(){"use strict";var e={center_radius:"40.7590615,-73.969231",radius:"50",style:[{stylers:[{saturation:-32},{hue:"#0099ff"}]}],options:{zoom:15,disableDefaultUI:!0,maxZoom:18,minZoom:11,center:{}},max_tips:30},n={},t={},o={},r={},i={},a={},s={},c={},l={anchor:new google.maps.Point(16,42),scaledSize:new google.maps.Size(32,32),url:""},u={url:"/assets/images/map-shadow.png",scaledSize:new google.maps.Size(38,45)},p=function(s){c=this;var l=e.center_radius.split(",").map(Number);a=new google.maps.LatLng(l[0],l[1]),e.options.center=a,n=new google.maps.Map(document.getElementById(s),e.options),n.setOptions({styles:e.style}),t=new google.maps.places.PlacesService(n),r=new google.maps.Marker({}),i=new google.maps.Marker({}),o=new google.maps.InfoWindow,google.maps.event.addListener(n,"click",function(){o.close()})},g=function(n,o){var r={location:a,radius:e.radius,query:n+", "+o.address+", NY"},i=new $.Deferred;return t.textSearch(r,function(e,n){n==google.maps.places.PlacesServiceStatus.OK?i.resolve(e[0]):(void 0,i.reject())}),i.promise()},m=function(e,t,o){r.setMap(null),i.setMap(null),n.panTo(e.geometry.location),s=e,c.fs=o,"undefined"!=typeof o.tips?(i=new google.maps.Marker({position:e.geometry.location,map:n,icon:u,zIndex:0,clickable:!1}),l.url=o.venue.icon_url,r=new google.maps.Marker({map:n,position:e.geometry.location,title:t,icon:l,zIndex:1}),google.maps.event.addListener(r,"click",f)):(void 0,r=new google.maps.Marker({map:n,position:e.geometry.location,title:t}))},f=function(){t.getDetails(s,function(e,n){return n!=google.maps.places.PlacesServiceStatus.OK?(void 0,void void 0):void d(0,e.name)})},d=function(e,t){var i=c.fs.get_tip(e),a="";if("undefined"==typeof i){var s=_.template($("#map-infowindow-template-error").html());a=s()}else{var l=c.fs.tips.response.tips.count,u={index:e+1,name:t,tip:i,total_tips:Math.min(l,c.config.max_tips)},s=_.template($("#map-infowindow-template").html());a=s(u)}o.setContent(a),o.open(n,r),$(".arrow-left").click(function(){d(Math.max(e-1,0),t)}),$(".arrow-right").on("click",function(){d(Math.min(e+1,29),t)})};return{config:e,initialize:p,search:g,createMarker:m}},Foursquare=function(){"use strict";var e={client_id:"NV4ZGMW3U444RSQPTBPNCFDYBTYTQ1WKRRKBYLB4YSQ1BH2T",secret:"UHJHNVV2TMIHZUNP2J13ZPWP5F1XI0IRX3B3SAX2B4QMCVJX",search_venue_url:"https://api.foursquare.com/v2/venues/search?ll={%GEOCODE%}&query={%NAME%}&limit=1&intent=checkin&radius=5&client_id={%CLIENT_ID%}&client_secret={%SECRET%}&v={%DATE_YYYYMMDD%}",tips_url:"https://api.foursquare.com/v2/venues/{%VENUE_ID%}/tips?client_id={%CLIENT_ID%}&client_secret={%SECRET%}&v={%DATE_YYYYMMDD%}"},n={},t=function(e,t){var i=new $.Deferred;return o(e,t).done(function(e){n=e.response.venues[0],"undefined"==typeof n?(void 0,i.reject()):(n.icon_url=n.categories[0].icon.prefix+"bg_88"+n.categories[0].icon.suffix,r(n.id).done(function(e){i.resolve(n,e)}).fail(function(){void 0,i.reject()}))}).fail(function(){void 0,i.reject()}),i.promise()},o=function(n,t){var o=a(e.search_venue_url,{name:n,lat:t.geometry.location.lat(),lng:t.geometry.location.lng()});return $.getJSON(o)},r=function(n){var t=a(e.tips_url,{venue:n});return $.getJSON(t)},i=function(e){var n=this.tips;return!jQuery.isEmptyObject(n)&&e>-1&&e<n.response.tips.count-1?n.response.tips.items[e]:void 0},a=function(n,t){var o=new Date,r=o.toISOString().slice(0,10).replace(/-/g,""),i=n.replace("{%GEOCODE%}",t.lat+","+t.lng).replace("{%NAME%}",escape(t.name)).replace("{%CLIENT_ID%}",e.client_id).replace("{%SECRET%}",e.secret).replace("{%VENUE_ID%}",t.venue).replace("{%DATE_YYYYMMDD%}",r);return i};return{get_reviews:t,get_tip:i}};