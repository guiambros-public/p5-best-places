var Map=function(){"use strict";var e={el_id:"map-canvas-box",location:"",center_radius:"40.7590615,-73.969231",radius:"50",style:[{stylers:[{saturation:-32},{hue:"#0099ff"}]}],options:{zoom:15,disableDefaultUI:!0,maxZoom:18,minZoom:11,center:{}},max_tips:30},n={},t={},r={},o={},i={},a={},s={},c={anchor:new google.maps.Point(16,42),scaledSize:new google.maps.Size(32,32),url:""},l={url:"/assets/images/map-shadow.png",scaledSize:new google.maps.Size(38,45)},u={},p=function(s){u=this;var c=e.center_radius.split(",").map(Number);a=new google.maps.LatLng(c[0],c[1]),e.location=e.location||e.center_radius||"64.1748683,-51.7382954";var c=e.location.split(",").map(Number);e.options.center=new google.maps.LatLng(c[0],c[1]),e.el=s||e.el,n=new google.maps.Map(document.getElementById(e.el),e.options),n.setOptions({styles:e.style}),t=new google.maps.places.PlacesService(n),o=new google.maps.Marker({}),i=new google.maps.Marker({}),r=new google.maps.InfoWindow,google.maps.event.addListener(n,"click",function(){r.close()})},g=function(n,r){var o={location:a,radius:e.radius,query:n+", "+r.get("address")+", NY"},i=new $.Deferred;return t.textSearch(o,function(e,n){n==google.maps.places.PlacesServiceStatus.OK?i.resolve(e[0]):(void 0,i.reject())}),i.promise()},m=function(e,t,r){o.setMap(null),i.setMap(null),n.panTo(e.geometry.location),s=e,u.fs=r,"undefined"!=typeof r.tips?(i=new google.maps.Marker({position:e.geometry.location,map:n,icon:l,zIndex:0,clickable:!1}),c.url=r.venue.icon_url,o=new google.maps.Marker({map:n,position:e.geometry.location,title:t,icon:c,zIndex:1}),google.maps.event.addListener(o,"click",f)):(void 0,o=new google.maps.Marker({map:n,position:e.geometry.location,title:t}))},f=function(){t.getDetails(s,function(e,n){return n!=google.maps.places.PlacesServiceStatus.OK?(void 0,void void 0):void d(0,e.name)})},d=function(e,t){var i=u.fs.get_tip(e);if("undefined"==typeof i){var a=_.template($("#map-infowindow-template-error").html());l=a()}else{var s=u.fs.tips.response.tips.count,c={index:e+1,name:t,tip:i,total_tips:Math.min(s,u.config.max_tips)},l="",a=_.template($("#map-infowindow-template").html());l=a(c)}r.setContent(l),r.open(n,o),$(".arrow-left").click(function(){d(Math.max(e-1,0),t)}),$(".arrow-right").on("click",function(){d(Math.min(e+1,29),t)})};return{config:e,initialize:p,search:g,createMarker:m}},Foursquare=function(){"use strict";var e={client_id:"NV4ZGMW3U444RSQPTBPNCFDYBTYTQ1WKRRKBYLB4YSQ1BH2T",secret:"UHJHNVV2TMIHZUNP2J13ZPWP5F1XI0IRX3B3SAX2B4QMCVJX",search_venue_url:"https://api.foursquare.com/v2/venues/search?ll={%GEOCODE%}&query={%NAME%}&limit=1&intent=checkin&radius=5&client_id={%CLIENT_ID%}&client_secret={%SECRET%}&v={%DATE_YYYYMMDD%}",tips_url:"https://api.foursquare.com/v2/venues/{%VENUE_ID%}/tips?client_id={%CLIENT_ID%}&client_secret={%SECRET%}&v={%DATE_YYYYMMDD%}"},n={},t=function(e,t){var i=new $.Deferred;return r(e,t).done(function(e){n=e.response.venues[0],"undefined"==typeof n?(void 0,i.reject()):(n.icon_url=n.categories[0].icon.prefix+"bg_88"+n.categories[0].icon.suffix,o(n.id).done(function(e){i.resolve(n,e)}).fail(function(){void 0,i.reject()}))}).fail(function(){void 0,i.reject()}),i.promise()},r=function(n,t){var r=a(e.search_venue_url,{name:n,lat:t.geometry.location.lat(),lng:t.geometry.location.lng()});return $.getJSON(r)},o=function(n){var t=a(e.tips_url,{venue:n});return $.getJSON(t)},i=function(e){var n=this.tips;return!jQuery.isEmptyObject(n)&&e>-1&&e<n.response.tips.count-1?n.response.tips.items[e]:void 0},a=function(n,t){var r=new Date,o=r.toISOString().slice(0,10).replace(/-/g,""),i=n.replace("{%GEOCODE%}",t.lat+","+t.lng).replace("{%NAME%}",escape(t.name)).replace("{%CLIENT_ID%}",e.client_id).replace("{%SECRET%}",e.secret).replace("{%VENUE_ID%}",t.venue).replace("{%DATE_YYYYMMDD%}",o);return i};return{get_reviews:t,get_tip:i}},filteredCollection=function(e,n){var t;return t=new e.constructor,t._callbacks={},t.filterItems=function(r){var o;return o=e.filter(r),t._currentFilter=n,t.reset(o)},e.on("reset change destroy",function(){return t.filterItems(t._currentFilter)}),t.filterItems(n)};